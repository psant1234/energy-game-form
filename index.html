<!DOCTYPE html>
<html>
<head>
  <title>Energy Game Submission Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    h2 {
      color: #8A1538;
      text-align: center;
    }

    .logo {
      display: block;
      margin: 0 auto 20px auto;
      max-width: 150px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
      color: #8A1538;
    }

    select, input[type="number"], input[type="text"], input[type="password"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }

    button {
      background-color: #8A1538;
      color: white;
      border: none;
      padding: 10px 20px;
      margin-top: 20px;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background-color: #6d0f2e;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #8A1538;
      color: white;
    }

    #lastSubmission {
      margin-top: 20px;
      background-color: #eef0f2;
      padding: 15px;
      border-radius: 5px;
      font-size: 14px;
      color: #333;
    }
  </style>
  <script>
    const portfolioPlants = {
      'Bay_Views': ['MORRO_BAY_1-2', 'MORRO_BAY_3-4', 'MOSS_LANDING_6', 'MOSS_LANDING_7', 'OAKLAND'],
      'Beachfront': ['COOLWATER', 'ETIWANDA_1-4', 'ETIWANDA_5', 'ELLWOOD', 'MANDALAY_1-2', 'MANDALAY_3', 'ORMOND_BEACH_1', 'ORMOND_BEACH_2'],
      'Big_Coal': ['Four Corners', 'ALAMITOS_7', 'HUNTINGTON_BEACH_1-2', 'HUNTINGTON_BEACH_5', 'REDONDO_5-6', 'REDONDO_7-8'],
      'Big_Gas': ['EL_SEGUNDO_1-2', 'EL_SEGUNDO_3-4', 'LONG_BEACH', 'NORTH_ISLAND', 'ENCINA', 'KEARNY', 'SOUTH_BAY'],
      'East_Bay': ['PITTSBURGH_1-4', 'PITTSBURGH_5-6', 'PITTSBURG_7', 'CONTRA_COSTA_4-5', 'CONTRA_COSTA_6-7', 'POTRERO_HILL'],
      'Low_Fossil': ['HUMBOLDT', 'HELMS', 'HUNTERS_POINT_1-2', 'HUNTERS_POINT_4', 'DIABLO_CANYON_1'],
      'Old_Timers': ['BIG_CREEK', 'MOHAVE_1', 'MOHAVE_2', 'HIGHGROVE', 'SAN_BERNARDINO']
    };

    let currentUser = {};
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzKQPRedbiR6jJ4Ked4NIThDYP1rj7fEJ3att1EzMVmC_QzBtbverwqp1d_j7S2q3JGpg/exec';

    function getLastSubmission() {
      const display = document.getElementById("lastSubmission");
      display.innerHTML = "Loading last submission...";

      fetch(`${scriptURL}?action=last&username=${currentUser.username}`)
        .then(res => res.json())
        .then(data => {
          if (data.success && data.rows.length > 0) {
            display.innerHTML = `<b>Last Submission</b><br><br>`;
            data.rows.forEach(row => {
              const { plant, hour1, hour2, hour3, hour4 } = row;
              const price1 = document.querySelector(`input[name='${plant}_price1']`);
              const price2 = document.querySelector(`input[name='${plant}_price2']`);
              const price3 = document.querySelector(`input[name='${plant}_price3']`);
              const price4 = document.querySelector(`input[name='${plant}_price4']`);

              if (price1) price1.value = hour1;
              if (price2) price2.value = hour2;
              if (price3) price3.value = hour3;
              if (price4) price4.value = hour4;

              display.innerHTML += `<b>${plant}</b>: [${hour1}, ${hour2}, ${hour3}, ${hour4}]<br>`;
            });
          } else {
            display.innerHTML = "No previous submission found.";
          }
        })
        .catch(err => {
          display.innerHTML = "Error retrieving last submission.";
        });
    }
  </script>
</head>
<body>
  <div class="container">
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/0c/MIT_logo.svg" alt="MIT Logo" class="logo">
    <h2>Energy Game Submission Form</h2>

    <div id="loginSection">
      <label>Username:</label>
      <input type="text" id="username" name="username" autocomplete="username">

      <label>Password:</label>
      <input type="password" id="password" name="password" autocomplete="current-password">

      <button onclick="login()">Login</button>
    </div>

    <div id="formSection" style="display:none">
      <button onclick="logout()" style="float:right; background-color:#ccc; color:#333">Log Out</button>
      <form id="energyForm" onsubmit="event.preventDefault(); submitForm();">
        <input type="hidden" id="team" name="team">
        <input type="hidden" id="world" name="world">

        <div id="adminControls" style="display:none">
          <label for="world">World:</label>
          <select id="world" name="world">
            <option value="G1">G1</option>
            <option value="G2">G2</option>
            <option value="G3">G3</option>
          </select>

          <label for="portfolio">Portfolio:</label>
          <select id="portfolio" name="portfolio" onchange="adminLoadPortfolio()">
            <!-- Filled dynamically -->
          </select>
        </div>

        <div id="plantSection"></div>
        <button type="submit">Submit</button>
      </form>
    </div>
  </div>
</body>
</html>

